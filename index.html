<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PHENO&CO — Barbershop depuis 2009</title>
<meta name="color-scheme" content="dark light">
<style>
  :root{
    --bg:#000;--fg:#fff;--muted:#bdbdbd;--yellow:#ffd400;--grey:#444;--focus:#8ab4f8;
    --card:#0f0f0f;--line:#1f1f1f;--green:#25D366;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg);text-align:center}
  header{padding:24px}
  header img{width:180px;margin-bottom:10px}
  h1{margin:0;font-size:2.2rem;color:var(--yellow);letter-spacing:.5px}
  .sub{margin:4px 0;color:#ddd}
  .nav{display:flex;flex-direction:column;gap:18px;align-items:center;justify-content:center;margin:14px auto 18px}
  .btn{display:block;width:80%;max-width:520px;padding:18px 22px;border-radius:18px;font-weight:800;text-decoration:none;font-size:1.15rem;line-height:1.2}
  .btn:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
  .btn-yellow{background:var(--yellow);color:#000}
  .btn-grey{background:var(--grey);color:#fff}
  .btn:hover{opacity:.95}
  footer{padding:22px 18px;color:#aaa;font-size:.9rem;border-top:1px solid #1b1b1b}

  .modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:18px;z-index:999}
  .modal:target{display:flex}
  .box{max-width:980px;width:100%;background:var(--card);border:1px solid var(--line);border-radius:18px;padding:18px;max-height:88vh;overflow:auto;text-align:left}
  .box h2{margin:0 0 10px;color:var(--yellow);text-align:center}
  .close{display:inline-block;margin-top:12px;padding:10px 14px;background:#161616;border:1px solid #2a2a2a;border-radius:10px;color:#fff;text-decoration:none}

  label{display:block;margin:10px 0 6px}
  input,select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid #2a2a2a;background:#121212;color:#fff;font-size:16px}
  input[type="number"]{appearance:textfield}
  textarea{min-height:96px;resize:vertical}
  .row{display:grid;gap:12px}
  @media(min-width:680px){.row{grid-template-columns:1fr 1fr}}
  .section-title{font-weight:900;color:#fff;margin:14px 0 6px}
  .accent{color:#000;background:var(--yellow);padding:2px 8px;border-radius:8px;margin-left:8px}
  .hint{font-size:12px;color:#9aa0a6}
  .summary{border-top:1px dashed #2b2b2b;margin-top:16px;padding-top:12px;color:#e6e6e6}
  .summary small{color:#bdbdbd}
  .actions{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
  .btn-submit,.btn-reset{flex:1;min-width:160px;padding:14px 16px;border-radius:14px;border:none;font-weight:800;cursor:pointer}
  .btn-submit{background:var(--yellow);color:#000}
  .btn-reset{background:var(--grey);color:#fff}

  .modal.cgv .box{max-width:900px}
  .modal.cgv h3{color:var(--yellow);margin:0 0 10px}
  .modal.cgv h4{margin:14px 0 8px}
  .modal.cgv p,.modal.cgv li{color:#ddd}
  .modal.cgv ul{margin:0 0 8px 18px}
  .cgv-recap{border:1px solid #2a2a2a;border-radius:12px;padding:12px;background:#111;margin:8px 0}
  .cgv-recap h5{margin:0 0 6px;color:#ffd400}
  .tag{display:inline-block;background:#222;border:1px solid #333;border-radius:999px;padding:2px 8px;margin-right:6px;color:#ddd;font-size:12px}

  .status{position:fixed;right:8px;bottom:8px;font-size:12px;background:#0f0f0f;border:1px solid #222;color:#9eea9e;padding:6px 8px;border-radius:8px;opacity:.85}
</style>
</head>
<body>
  <header>
    <img src="1.png" alt="Logo PHENO&CO" onerror="this.style.display='none'">
    <h1>PHENO&CO</h1>
    <p class="sub">Barbershop depuis 2009</p>
    <p class="sub">18 Rue d'Alger, 34000 Montpellier</p>
  </header>

  <nav class="nav" aria-label="Actions principales">
    <a class="btn btn-yellow" href="#louer">Louer un fauteuil</a>
    <a class="btn btn-grey" href="https://phenoandco.com" target="_blank" rel="noopener">Réserver une coiffure</a>
  </nav>

  <footer>© 2025 PHENO&CO. Tous droits réservés.</footer>

  <!-- ============ MODAL LOUER UN FAUTEUIL ============ -->
  <div class="modal" id="louer" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true" aria-labelledby="title-fauteuil">
      <h2 id="title-fauteuil">Louer un fauteuil — Réservation</h2>
      <p class="hint">Choisis tes dates (calendrier), ta formule (courte OU longue durée), ton matériel. Les totaux et le contrat s’affichent automatiquement.</p>

      <form id="rentForm" autocomplete="on" novalidate>
        <!-- Identité -->
        <div class="row">
          <div><label for="f-name">Nom et prénom</label><input id="f-name" required placeholder="Ex. Jean Dupont"></div>
          <div><label for="f-phone">Téléphone</label><input id="f-phone" required inputmode="tel" placeholder="Ex. 06 12 34 56 78"></div>
        </div>
        <div class="row">
          <div><label for="f-email">Email (pour le récap)</label><input id="f-email" inputmode="email" placeholder="exemple@mail.com"></div>
          <div><label for="f-note">Message (optionnel)</label><input id="f-note" placeholder="Ex. Poste miroir 2, shaver…"></div>
        </div>

        <!-- Période -->
        <div class="section-title">Période <span class="accent">calendrier</span></div>
        <div class="row">
          <div>
            <label for="f-start-date">Date de début</label>
            <input type="date" id="f-start-date" />
          </div>
          <div>
            <label for="f-end-date">Date de fin</label>
            <input type="date" id="f-end-date" />
          </div>
        </div>

        <!-- Heures -->
        <div class="row">
          <div>
            <label for="f-start-time">Heure d’arrivée (10:00–18:00)</label>
            <select id="f-start-time">
              <option>10:00</option><option>11:00</option><option>12:00</option><option>13:00</option>
              <option>14:00</option><option>15:00</option><option>16:00</option><option>17:00</option><option>18:00</option>
            </select>
          </div>
          <div>
            <label for="f-hours-per-day">Heures par jour</label>
            <select id="f-hours-per-day">
              <option>1</option><option>2</option><option>3</option><option selected>4</option>
              <option>5</option><option>6</option><option>7</option><option>8</option>
              <option>9</option><option>10</option>
            </select>
            <div class="hint">Heures entières (1–10)</div>
          </div>
        </div>

        <!-- Formules -->
        <div class="section-title">Formules de location <span class="accent">tarifs HT</span></div>
        <div class="row">
          <div>
            <label for="formula-short">Formule courte durée (si choisie, l’autre se désactive)</label>
            <select id="formula-short">
              <option value="">— Choisir —</option>
              <option value="hour">1h — 10,00 € HT</option>
              <option value="halfday">½ journée (4h) — 45,00 € HT</option>
              <option value="fullday">1 journée (8h) — 70,00 € HT</option>
              <option value="week">1 semaine (5 jours) — 280,00 € HT</option>
            </select>
          </div>
          <div>
            <label for="formula-long">Formule longue durée (affichage €/jour HT)</label>
            <select id="formula-long">
              <option value="">— Choisir —</option>
              <option value="m1">1 mois — 65 € / jour (HT) + redevance 2%/mois</option>
              <option value="m3">3 mois — 60 € / jour (HT) + redevance 2%/mois</option>
              <option value="m6">6 mois — 55 € / jour (HT) + redevance 2%/mois</option>
              <option value="m12">12 mois — 50 € / jour (HT) + redevance 2%/mois</option>
            </select>
            <div class="hint">Le total est calculé automatiquement (base 20 jours ouvrés/mois). Redevance 2%/mois : séparée, affichée dans le récap/CGV.</div>
          </div>
        </div>

        <!-- (Optionnel) CA estimé pour redevance 2% -->
        <div id="caBlock" class="row" style="display:none">
          <div>
            <label for="f-ca">CA mensuel estimé (optionnel, HT)</label>
            <input id="f-ca" type="number" min="0" step="50" placeholder="Ex. 4000" />
            <div class="hint">Redevance estimée = 2% × CA × nb de mois (indicatif).</div>
          </div>
          <div>
            <label>Redevance 2% estimée</label>
            <input id="f-fee-est" disabled placeholder="—" />
          </div>
        </div>

        <!-- Matériel — 100% menus déroulants (quantités) -->
        <div class="section-title">Location petits matériels <span class="accent">par jour</span></div>
        <div class="row">
          <div>
            <label for="q-clipper">Tondeuse classique — 10 € / jour</label>
            <select id="q-clipper"><option value="0" selected>0</option><option>1</option><option>2</option><option>3</option></select>
          </div>
          <div>
            <label for="q-trimmer">Tondeuse finition — 8 € / jour</label>
            <select id="q-trimmer"><option value="0" selected>0</option><option>1</option><option>2</option><option>3</option></select>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="q-shaver">Shaver — 6 € / jour</label>
            <select id="q-shaver"><option value="0" selected>0</option><option>1</option><option>2</option><option>3</option></select>
          </div>
          <div>
            <label for="q-dryer">Sèche-cheveux — 8 € / jour</label>
            <select id="q-dryer"><option value="0" selected>0</option><option>1</option><option>2</option><option>3</option></select>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="q-cape">Cape — 1 € / jour</label>
            <select id="q-cape"><option value="0" selected>0</option><option>1</option><option>2</option><option>3</option><option>4</option></select>
          </div>
          <div>
            <label for="q-towel">Serviettes (lot de 4) — 4 € / jour</label>
            <select id="q-towel"><option value="0" selected>0</option><option>1</option><option>2</option><option>3</option><option>4</option></select>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="q-pack-ess">Pack Essentiel — 20 € / jour</label>
            <select id="q-pack-ess"><option value="0" selected>0</option><option>1</option></select>
            <div class="hint">1 classique, 1 finition, 2 serviettes, 1 cape</div>
          </div>
          <div>
            <label for="q-pack-prem">Pack Premium — 30 € / jour</label>
            <select id="q-pack-prem"><option value="0" selected>0</option><option>1</option></select>
            <div class="hint">1 classique, 1 finition, 1 shaver, 4 serviettes, 2 capes</div>
          </div>
        </div>

        <!-- CGV -->
        <label style="display:flex;align-items:center;gap:8px;margin-top:14px">
          <input type="checkbox" id="f-cgv" required>
          <span>J’ai lu et j’accepte les <a href="#cgv" id="cgvLink" style="color:#8ab4f8">CGV (avec récap contrat)</a>.</span>
        </label>

        <!-- Résumé -->
        <div class="summary">
          <div><small>Période :</small> <span id="sum-period">—</span></div>
          <div><small>Formule :</small> <span id="sum-formula">—</span> <span class="tag" id="sum-mode">—</span></div>
          <div><small>Heures/jour :</small> <span id="sum-hpd">0</span></div>
          <div><small>Matériel HT :</small> <span id="sum-gear">0 €</span></div>

          <div style="margin-top:8px"><small><b>Loyer</b> :</small></div>
          <div><small>Total loyer HT :</small> <span id="sum-ht">0 €</span></div>
          <div><small>TVA (20%) :</small> <span id="sum-tva">0 €</span></div>
          <div><b>Total TTC (loyer) :</b> <span id="sum-ttc">0 €</span></div>

          <div style="margin-top:8px"><small><b>Acompte</b> :</small> <span id="sum-deposit-rate">—</span></div>
          <div><small>Acompte TTC :</small> <span id="sum-deposit">0 €</span> • <small>Équiv. couvert :</small> <span id="sum-equivalence">—</span></div>

          <div id="fee-block" style="margin-top:8px;display:none">
            <div><small><b>Solde TTC :</b></small> <span id="sum-soldettc">0 €</span></div>
            <div><small><b>Redevance 2% :</b></small> <span id="sum-fee-detail">—</span></div>
            <div><small><b>TTC/jour final (loyer + redevance) :</b></small> <span id="sum-ttc-perday-final">—</span></div>
          </div>
        </div>

        <div class="actions">
          <button class="btn-submit" type="submit">Confirmer & envoyer (WhatsApp)</button>
          <button class="btn-reset" type="reset" id="resetBtn">Effacer</button>
          <a id="emailLink" class="btn btn-grey" href="#" target="_blank" rel="noopener">Envoyer aussi par e-mail</a>
        </div>

        <a href="#" class="close">Fermer</a>
      </form>
    </div>
  </div>

  <!-- ============ MODAL CGV ============ -->
  <div class="modal cgv" id="cgv" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true" aria-labelledby="cgvTitle">
      <h3 id="cgvTitle">CGV — PHENO&CO (récapitulatif contrat)</h3>
      <div class="cgv-recap">
        <h5>Récapitulatif de votre sélection</h5>
        <p><b>Identité :</b> <span id="cv-name">—</span> • <b>Téléphone :</b> <span id="cv-phone">—</span> • <b>Email :</b> <span id="cv-email">—</span></p>
        <p><b>Période :</b> <span id="cv-period">—</span> • <b>Heures/jour :</b> <span id="cv-hpd">—</span></p>
        <p><b>Formule :</b> <span id="cv-formula">—</span> <span class="tag" id="cv-mode">—</span></p>
        <p><b>Matériel sélectionné :</b> <span id="cv-gear-list">—</span></p>

        <p><b>Total loyer HT :</b> <span id="cv-ht">0 €</span> • <b>TVA 20% :</b> <span id="cv-tva">0 €</span> • <b>Total TTC (loyer) :</b> <span id="cv-ttc">0 €</span></p>
        <p><b>Acompte (<span id="cv-deposit-rate">—</span>) :</b> <span id="cv-deposit">0 €</span> • <b>Équiv. couvert :</b> <span id="cv-equivalence">—</span></p>

        <div id="cv-fee-block" style="display:none">
          <p><b>Solde TTC :</b> <span id="cv-soldettc">0 €</span></p>
          <p><b>Redevance 2% :</b> <span id="cv-fee-detail">—</span></p>
          <p><b>TTC/jour final (loyer + redevance) :</b> <span id="cv-ttc-perday-final">—</span></p>
        </div>

        <p class="hint">
          La redevance 2% (HT) est appliquée en longue durée sur le solde TTC, après acompte.  
          Elle est facturée séparément, mensuellement, et correspond à l’accès à l’espace personnel (planning client).
        </p>
      </div>

      <h4>Conditions Générales de Vente et de Location – PHENO&CO</h4>
      <ul>
        <li><b>Objet :</b> location de fauteuils et matériels au sein du salon PHENO&CO (18 rue d’Alger, Montpellier). Validation = contrat.</li>
        <li><b>Tarifs :</b> courte durée (heure/½ journée/journée/semaine), longue durée (engagement mensuel/trimestriel/semestriel/annuel). Tarifs HT & TTC.</li>
        <li><b>Acomptes :</b> courte durée = 50% TTC ; longue durée = 25% TTC. Acompte = loyer d’avance, déductible du solde.</li>
        <li><b>Paiement :</b> lien électronique, virement, espèces/chèque. Solde : fin de prestation (courte) / fin de mois (longue).</li>
        <li><b>Redevance 2% :</b> appliquée en longue durée sur le solde TTC (après acompte), facturée mensuellement.</li>
        <li><b>Obligations locataire :</b> hygiène/sécurité, RC Pro, sincérité du CA, pas de sous-location sans accord.</li>
        <li><b>Obligations bailleur :</b> mise à disposition conforme, maintenance lourde, confidentialité.</li>
        <li><b>Résiliation :</b> courte durée : annulation ≤48h → acompte non remboursé mais reportable 1 fois. Longue durée : préavis 1 mois (ou immédiate en cas de faute grave).</li>
        <li><b>Litiges :</b> médiation amiable puis tribunaux de Montpellier.</li>
      </ul>

      <a href="#" class="close">Fermer</a>
    </div>
  </div>

  <!-- Indicateur statut -->
  <div class="status" id="status">OK</div>

<script>
/* ===== CONFIG ===== */
const PHONE='33769432605';
const EMAIL='location.phenoandco@gmail.com';
const TVA=0.20;
const WORK_DAYS_PER_MONTH=20;

/* Tarifs (HT) */
const SHORT_PRICES = {
  hour:     { label:'1h',              pricePerHour: 10 },
  halfday:  { label:'½ journée (4h)',  fixedPerBlock: 45, hoursPerDay: 4 },
  fullday:  { label:'1 journée (8h)',  fixedPerBlock: 70, hoursPerDay: 8 },
  week:     { label:'1 semaine (5 jours)', fixedPerBlock: 280, daysPerBlock: 5 }
};
const LONG_PRICES = {
  m1:  { label:'1 mois',   months:1,  perDay:65 },
  m3:  { label:'3 mois',   months:3,  perDay:60 },
  m6:  { label:'6 mois',   months:6,  perDay:55 },
  m12: { label:'12 mois',  months:12, perDay:50 }
};
const GEAR = [
  { id:'q-clipper',   label:'Tondeuse classique',       price:10 },
  { id:'q-trimmer',   label:'Tondeuse finition',        price:8  },
  { id:'q-shaver',    label:'Shaver',                   price:6  },
  { id:'q-dryer',     label:'Sèche-cheveux',            price:8  },
  { id:'q-cape',      label:'Cape',                     price:1  },
  { id:'q-towel',     label:'Serviettes (lot de 4)',    price:4  },
  { id:'q-pack-ess',  label:'Pack Essentiel',           price:20 },
  { id:'q-pack-prem', label:'Pack Premium',             price:30 },
];

/* Utils */
const fmt = new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'});
const $ = (id)=>document.getElementById(id);
function pad2(v){return String(v).padStart(2,'0');}
function todayYMD(){ const t=new Date(); return `${t.getFullYear()}-${pad2(t.getMonth()+1)}-${pad2(t.getDate())}`; }
function parseDate(value){ return value? new Date(`${value}T00:00:00`) : null; }
function daysInclusive(a,b){ const A=new Date(a.getFullYear(),a.getMonth(),a.getDate()); const B=new Date(b.getFullYear(),b.getMonth(),b.getDate()); return Math.max(1, Math.floor((B-A)/86400000)+1); }
function periodText(a,b,arr){ const s=`${a.getFullYear()}-${pad2(a.getMonth()+1)}-${pad2(a.getDate())}`, e=`${b.getFullYear()}-${pad2(b.getMonth()+1)}-${pad2(b.getDate())}`; return `${s} → ${e} (arrivée ${arr})`; }

/* Elements */
const fStartDate=$('f-start-date'), fEndDate=$('f-end-date');
const fName=$('f-name'), fPhone=$('f-phone'), fEmail=$('f-email'), fNote=$('f-note');
const startTime=$('f-start-time'), hpd=$('f-hours-per-day');
const fs=$('formula-short'), fl=$('formula-long');
const caBlock=$('caBlock'), fCA=$('f-ca');
const statusEl=$('status');
const sum = (id)=>$(id);

/* Init dates */
(function init(){
  const t=todayYMD(); fStartDate.value=t; fEndDate.value=t;
  startTime.value='10:00'; hpd.value='4';
  updateAll();
})();

/* Exclusivité formules */
function lockFormulas(e){
  if(e.target===fs && fs.value){ fl.value=''; fl.disabled=true; caBlock.style.display='none'; }
  else if(e.target===fl && fl.value){ fs.value=''; fs.disabled=true; hpd.disabled=false; caBlock.style.display='grid'; }
  if(!fs.value && !fl.value){ fs.disabled=false; fl.disabled=false; caBlock.style.display='none'; }
  if(fs.value==='halfday'){ hpd.value='4'; hpd.disabled=true; } 
  else if(fs.value==='fullday'){ hpd.value='8'; hpd.disabled=true; } 
  else { if(!fl.value) hpd.disabled=false; }
  updateAll();
}
fs.addEventListener('change',lockFormulas);
fl.addEventListener('change',lockFormulas);

/* Matériel coût */
function gearCost(months, days){
  let perDay=0; const labels=[];
  GEAR.forEach(g=>{ const q = Number($(g.id).value||0); if(q>0){ perDay+=g.price*q; labels.push(`${g.label} x${q}`); }});
  const mult = months>0 ? (WORK_DAYS_PER_MONTH*months) : Math.max(1, days);
  return { cost: perDay*mult, labels };
}

/* TTC par jour/heures (pour équivalence acomptes) — COURTE durée */
function shortTtcUnit(fsKey){
  if(fsKey==='hour'){ return 10*1.20; } // 12 €/h
  if(fsKey==='halfday'){ return (45*1.20)/4; } // 13.5 €/h
  if(fsKey==='fullday'){ return 70*1.20; } // 84 €/jour
  if(fsKey==='week'){ return (280*1.20)/5; } // 67.2 €/jour
  return 0;
}

function compute(){
  let sd=parseDate(fStartDate.value) || new Date();
  let ed=parseDate(fEndDate.value) || sd;
  if(ed<sd) ed=sd;
  const days = daysInclusive(sd,ed);
  const hoursPerDay = Number(hpd.value||0);

  let mode='—', months=0, formulaLabel='—', baseHt=0, autoEnd='';
  // Courte durée (loyer base)
  if(fs.value){
    mode='Courte durée';
    const k=fs.value, def=SHORT_PRICES[k];
    formulaLabel=def.label;
    if(k==='hour'){ baseHt=(days*hoursPerDay)*SHORT_PRICES.hour.pricePerHour; }
    else if(k==='halfday'){ baseHt=days*def.fixedPerBlock; }
    else if(k==='fullday'){ baseHt=days*def.fixedPerBlock; }
    else if(k==='week'){ const weeks=Math.ceil((days||0)/def.daysPerBlock); baseHt=weeks*def.fixedPerBlock; }
  }
  // Longue durée (€/jour HT × 20 j/mois × nb mois)
  else if(fl.value){
    mode='Longue durée';
    const def=LONG_PRICES[fl.value];
    months=def.months;
    formulaLabel=`${def.label} — ${def.perDay} € / jour (HT) + redevance 2%/mois`;
    baseHt=def.perDay*WORK_DAYS_PER_MONTH*def.months;
    const end=new Date(sd.getFullYear(), sd.getMonth()+def.months, sd.getDate());
    autoEnd=` (fin approx. ${end.getFullYear()}-${pad2(end.getMonth()+1)}-${pad2(end.getDate())})`;
  }

  const gear=gearCost(months, days);

  // Loyer
  const totalHt = baseHt + gear.cost;
  const tva = totalHt*TVA;
  const ttc = totalHt + tva;

  // Acompte
  const depositRate = (mode==='Longue durée') ? 0.25 : 0.50;
  const depositTtc = ttc*depositRate;
  const soldeTtc = ttc - depositTtc;

  // Redevance (longue durée)
  let fee = 0;
  if(mode==='Longue durée'){ fee = soldeTtc * 0.02; } // 2% du solde TTC
  const finalTtc = ttc + fee;

  // TTC/jour final (longue durée) pour équivalence & pédagogie
  let ttcPerDayFinal = null, equivalenceText='—';
  if(mode==='Longue durée'){
    const totalDays = WORK_DAYS_PER_MONTH * Math.max(1, months);
    ttcPerDayFinal = finalTtc / totalDays;
    const daysCovered = depositTtc / ttcPerDayFinal;
    equivalenceText = `≈ ${daysCovered.toFixed(1)} jour(s) couverts`;
  } else if(mode==='Courte durée' && fs.value){
    const k=fs.value;
    const unit = shortTtcUnit(k);
    if(k==='hour' || k==='halfday'){ // exprimer en heures
      const hoursCovered = depositTtc / unit;
      equivalenceText = `≈ ${hoursCovered.toFixed(1)} h couvertes`;
    } else { // fullday / week → en jours
      const perDayTtc = (k==='fullday') ? unit : shortTtcUnit('week'); // 84 ou 67.2
      const daysCovered = depositTtc / perDayTtc;
      equivalenceText = `≈ ${daysCovered.toFixed(1)} jour(s) couverts`;
    }
  }

  return { sd, ed, days, hoursPerDay, mode, months, formulaLabel, baseHt, gearList:gear.labels, gearHt:gear.cost,
           totalHt, tva, ttc, depositRate, depositTtc, soldeTtc, fee, finalTtc, ttcPerDayFinal, autoEnd, equivalenceText };
}

function updateAll(){
  try{
    const c=compute();
    const period = periodText(c.sd,c.ed,$('f-start-time').value) + (c.autoEnd||'');

    // Résumé
    sum('sum-period').textContent = period;
    sum('sum-formula').textContent = c.formulaLabel;
    sum('sum-mode').textContent    = c.mode;
    sum('sum-hpd').textContent     = c.hoursPerDay;
    sum('sum-gear').textContent    = fmt.format(c.gearHt);
    sum('sum-ht').textContent      = fmt.format(c.totalHt);
    sum('sum-tva').textContent     = fmt.format(c.tva);
    sum('sum-ttc').textContent     = fmt.format(c.ttc);
    sum('sum-deposit-rate').textContent = c.mode==='Longue durée' ? '25% TTC' : '50% TTC';
    sum('sum-deposit').textContent = fmt.format(c.depositTtc);
    sum('sum-equivalence').textContent = c.equivalenceText;

    // Longue durée : solde + redevance + ttc/jour final
    const feeBlockVisible = (c.mode==='Longue durée');
    sum('fee-block').style.display = feeBlockVisible ? 'block' : 'none';
    if(feeBlockVisible){
      sum('sum-soldettc').textContent = fmt.format(c.soldeTtc);
      const feeText = `${fmt.format(c.fee)} (2% × ${fmt.format(c.soldeTtc)})`;
      sum('sum-fee-detail').textContent = feeText;
      sum('sum-ttc-perday-final').textContent = c.ttcPerDayFinal ? fmt.format(c.ttcPerDayFinal) : '—';
    }

    // Email (mailto)
    const subject=encodeURIComponent(`Demande de location de fauteuil — ${fName.value||''}`);
    const body=encodeURIComponent(
`Demande de location — PHENO&CO
Nom: ${fName.value||'-'}
Téléphone: ${fPhone.value||'-'}
Email: ${fEmail.value||'-'}
Période: ${period}
Formule: ${c.mode} — ${c.formulaLabel}
Heures/jour: ${c.hoursPerDay}

Loyer:
  • Total HT: ${fmt.format(c.totalHt)}
  • TVA 20%: ${fmt.format(c.tva)}
  • Total TTC (loyer): ${fmt.format(c.ttc)}

Acompte (${c.mode==='Longue durée'?'25%':'50%'} TTC):
  • Acompte TTC: ${fmt.format(c.depositTtc)}
  • Équivalence: ${c.equivalenceText}

${c.mode==='Longue durée' ? 
`Longue durée — détails:
  • Solde TTC: ${fmt.format(c.soldeTtc)}
  • Redevance 2%: ${fmt.format(c.fee)} (2% × ${fmt.format(c.soldeTtc)})
  • TTC/jour final (loyer + redevance): ${c.ttcPerDayFinal?fmt.format(c.ttcPerDayFinal):'—'}` : ''}

Matériel: ${c.gearList.join(', ') || '-'}
CGV/Contrat: accepté si coché.`);
    $('emailLink').href=`mailto:${EMAIL}?subject=${subject}&body=${body}`;

    // CGV récap
    sum('cv-name').textContent   = fName.value||'—';
    sum('cv-phone').textContent  = fPhone.value||'—';
    sum('cv-email').textContent  = fEmail.value||'—';
    sum('cv-period').textContent = period;
    sum('cv-hpd').textContent    = c.hoursPerDay||'—';
    sum('cv-formula').textContent= c.formulaLabel||'—';
    sum('cv-mode').textContent   = c.mode||'—';
    sum('cv-gear-list').textContent = (c.gearList.length? c.gearList.join(', ') : '—');

    sum('cv-ht').textContent     = fmt.format(c.totalHt);
    sum('cv-tva').textContent    = fmt.format(c.tva);
    sum('cv-ttc').textContent    = fmt.format(c.ttc);

    sum('cv-deposit-rate').textContent = c.mode==='Longue durée' ? '25% TTC' : '50% TTC';
    sum('cv-deposit').textContent  = fmt.format(c.depositTtc);
    sum('cv-equivalence').textContent = c.equivalenceText;

    const cvFeeVis = (c.mode==='Longue durée');
    sum('cv-fee-block').style.display = cvFeeVis ? 'block' : 'none';
    if(cvFeeVis){
      sum('cv-soldettc').textContent = fmt.format(c.soldeTtc);
      sum('cv-fee-detail').textContent = `${fmt.format(c.fee)} (2% × ${fmt.format(c.soldeTtc)})`;
      sum('cv-ttc-perday-final').textContent = c.ttcPerDayFinal? fmt.format(c.ttcPerDayFinal) : '—';
    }

    statusEl.textContent='OK'; statusEl.style.color='#9eea9e';
  }catch(err){
    statusEl.textContent='ERREUR: '+(err.message||err); statusEl.style.color='#ff7b7b';
    console.error(err);
  }
}

/* Listeners (dates, inputs, selects) */
['input','change'].forEach(evt=>{
  [fStartDate,fEndDate,fName,fPhone,fEmail,fNote,startTime,hpd,fs,fl,fCA]
    .forEach(el=>el.addEventListener(evt,updateAll));
  GEAR.forEach(g=>$(`${g.id}`).addEventListener('change',updateAll));
});

/* Reset */
$('resetBtn').onclick=()=>setTimeout(()=>{
  const t=todayYMD(); fStartDate.value=t; fEndDate.value=t;
  fName.value=''; fPhone.value=''; fEmail.value=''; fNote.value='';
  startTime.value='10:00'; hpd.value='4';
  fs.value=''; fl.value=''; fs.disabled=false; fl.disabled=false; hpd.disabled=false;
  GEAR.forEach(g=>{ $(`${g.id}`).value='0'; });
  caBlock.style.display='none'; if(fCA) fCA.value='';
  updateAll();
},0);

/* Submit => WhatsApp */
$('rentForm').addEventListener('submit',(e)=>{
  e.preventDefault();
  if(!(fName.value.trim() && fPhone.value.trim())){ alert('Merci de renseigner nom/prénom et téléphone.'); return; }
  if(!$('f-cgv').checked){ alert('Merci d’accepter les CGV (clique pour voir le contrat).'); return; }
  if(!fs.value && !fl.value){ alert('Choisis une formule (courte OU longue durée).'); return; }

  const c=compute();
  const msg =
`Demande de location — PHENO&CO
• Nom: ${fName.value.trim()}
• Tel: ${fPhone.value.trim()} • Email: ${fEmail.value||'-'}
• Période: ${periodText(c.sd,c.ed,$('f-start-time').value)}${c.autoEnd||''}
• Formule: ${c.mode} — ${c.formulaLabel}
• Heures/jour: ${c.hoursPerDay}

Loyer:
• Total HT: ${fmt.format(c.totalHt)} • TVA: ${fmt.format(c.tva)} • Total TTC: ${fmt.format(c.ttc)}

Acompte (${c.mode==='Longue durée'?'25%':'50%'} TTC):
• Acompte TTC: ${fmt.format(c.depositTtc)} • Équivalence: ${c.equivalenceText}

${c.mode==='Longue durée' ? 
`Longue durée — détails:
• Solde TTC: ${fmt.format(c.soldeTtc)}
• Redevance 2%: ${fmt.format(c.fee)} (2% × ${fmt.format(c.soldeTtc)})
• TTC/jour final: ${c.ttcPerDayFinal?fmt.format(c.ttcPerDayFinal):'—'}` : ''}

Matériel: ${c.gearList.join(', ') || '-'}
CGV: accepté ✅ — merci d’envoyer le lien d’acompte.`;
  window.open(`https://wa.me/${PHONE}?text=${encodeURIComponent(msg)}`,'_blank','noopener');
});

/* Premier calcul */
updateAll();
</script>
</body>
</html>
