<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>R√©servation de fauteuil ‚Äì PHENO&CO</title>
  <!-- EmailJS SDK -->
  <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
  </script>
  <script type="text/javascript">
   (function(){
      // Initialize EmailJS with your public key
      emailjs.init({
        publicKey: "uBxESnC6CTyqiNyS6",
      });
   })();
  </script>
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #050608;
      color: #f9fafb;
      line-height: 1.5;
    }

    /* --- HERO SECTION STYLES --- */
    .hero {
      background: #000000;
      padding: 40px 20px 50px;
      text-align: center;
      border-bottom: 1px solid #1f2937;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    .hero-logo {
        margin-bottom: -10px;
        z-index: 10;
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .hero-logo img {
      width: 200px;
      height: auto;
      max-width: 100%;
      display: block;
    }

    .hero-titles {
      padding-top: 0;
      z-index: 0;
      position: relative;
      width: 100%;
    }

    .hero h1 {
      color: #F9C800;
      font-size: 3rem;
      margin: 0;
      letter-spacing: -1px;
      text-transform: uppercase;
      line-height: 1.1;
    }

    .hero p.subtitle {
      color: #ffffff;
      font-size: 1.1rem;
      margin: 8px 0 0 0;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .hero-buttons {
      display: flex;
      gap: 16px;
      margin-top: 30px;
      width: 100%;
      max-width: 800px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .hero-btn {
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      text-decoration: none;
      cursor: pointer;
      border: none;
      flex: 1;
      min-width: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, opacity 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      text-align: center;
    }

    .hero-btn:hover {
      transform: translateY(-2px);
      opacity: 0.95;
    }

    .hero-btn:active {
      transform: translateY(0);
    }

    .btn-yellow {
      background: #F9C800;
      color: #000000;
    }

    .btn-dark {
      background: #111827;
      color: #ffffff;
      border: 1px solid #374151;
    }

    .btn-green {
      background: #25D366;
      color: #ffffff;
    }

    /* --- PAGE CONTENT --- */
    .page {
      max-width: 1000px;
      margin: auto;
      padding: 24px 16px 60px;
      width: 100%;
    }

    h1, h2, h3 {
      color: #ffd42a;
      margin-top: 0;
    }

    .page h1 {
      text-align: center;
      margin-bottom: 16px;
      font-size: 2rem;
      line-height: 1.2;
    }

    p.intro {
      text-align: center;
      margin-bottom: 32px;
      opacity: 0.8;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }

    .card {
      background: #0b1220;
      border-radius: 16px;
      padding: 24px;
      border: 1px solid #1f2937;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }

    /* --- FORM ELEMENTS --- */
    label {
      display: block;
      font-size: 14px;
      margin-bottom: 8px;
      opacity: 0.9;
      font-weight: 500;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    input[type="time"],
    select,
    textarea {
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid #374151;
      background: #020617;
      color: #f9fafb;
      font-size: 16px;
      margin-bottom: 16px;
      font-family: inherit;
      appearance: none;
      -webkit-appearance: none;
    }
    
    select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
    }

    input[type="date"] {
      min-height: 46px;
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
        filter: none;
        background-color: #F9C800;
        padding: 8px;
        cursor: pointer;
        border-radius: 6px;
        color: black;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .radio-row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .radio-pill {
      flex: 1;
      border-radius: 12px;
      border: 1px solid #4b5563;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      font-size: 14px;
      background: #020617;
      transition: all 0.2s;
      position: relative;
    }
    
    .radio-pill:hover {
      border-color: #F9C800;
    }
    
    .radio-pill.active {
      background: #1f2937;
      border-color: #F9C800;
      box-shadow: 0 0 0 1px #F9C800;
    }

    .radio-pill input {
      margin: 0;
      accent-color: #F9C800;
      width: 18px;
      height: 18px;
    }

    .radio-pill span {
      font-weight: 600;
      display: block;
      margin-bottom: 2px;
    }

    .muted {
      font-size: 12px;
      opacity: 0.7;
      line-height: 1.3;
      display: block;
    }

    .btn {
      width: 100%;
      padding: 16px;
      border-radius: 999px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #374151 !important;
      color: #9ca3af !important;
    }

    .btn-primary {
      background: #ffd42a;
      color: #000;
      box-shadow: 0 4px 12px rgba(255, 212, 42, 0.3);
    }
    
    .btn-primary:hover:not(:disabled) {
      background: #eec025;
      transform: translateY(-1px);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn-calendar {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #60a5fa;
      font-size: 14px;
      padding: 10px 16px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      margin-top: 12px;
      margin-bottom: 8px;
      transition: all 0.2s;
    }
    
    .btn-calendar:hover {
      background: rgba(59, 130, 246, 0.2);
      color: #93c5fd;
    }

    .summary-box {
      background: #020617;
      border-radius: 14px;
      border: 1px solid #4b5563;
      padding: 16px;
      margin-top: 16px;
      font-size: 14px;
    }

    .summary-box h3 {
      margin-bottom: 12px;
      font-size: 16px;
      border-bottom: 1px solid #1f2937;
      padding-bottom: 8px;
      color: #ffd42a;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
    }
    
    .summary-row.total-ht {
      border-top: 1px solid #1f2937;
      padding-top: 8px;
      margin-top: 8px;
      font-weight: bold;
      font-size: 15px;
    }
    
    .summary-row.total-ttc {
      color: #ffd42a;
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 12px;
    }
    
    .summary-row.acompte {
      color: #22c55e;
      font-weight: bold;
      margin-top: 4px;
    }

    .warning {
      font-size: 13px;
      color: #facc15;
      margin-top: 12px;
      padding: 12px;
      background: rgba(250, 204, 21, 0.1);
      border-radius: 8px;
      line-height: 1.4;
    }

    .checkbox-row {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-top: 16px;
      margin-bottom: 8px;
      font-size: 14px;
      line-height: 1.4;
    }

    .checkbox-row input {
      margin-top: 3px;
      accent-color: #F9C800;
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    a.cgv-link {
      color: #ffd42a;
      text-decoration: underline;
      cursor: pointer;
    }

    .section-title {
      font-size: 18px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
    }

    .section-title span.icon {
      font-size: 20px;
    }
    
    /* Confirmation Message Styles */
    .confirmation-box {
      display: none;
      margin-top: 24px;
      padding: 20px;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 12px;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .confirmation-box h4 {
      color: #22c55e;
      font-weight: bold;
      font-size: 18px;
      margin: 0 0 12px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .confirmation-box p {
      margin: 6px 0;
      font-size: 14px;
      color: #d1d5db;
      line-height: 1.5;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    footer {
      text-align: center;
      margin-top: 60px;
      font-size: 13px;
      color: #6b7280;
      padding-bottom: 20px;
    }

    @media (min-width: 820px) {
      .grid {
        grid-template-columns: 1.2fr 1fr;
      }
    }

    @media (max-width: 768px) {
      .hero-buttons {
        flex-direction: column;
      }
      .hero-btn {
        width: 100%;
      }
      .hero h1 {
        font-size: 2.2rem;
      }
      .hero-logo img {
        width: 160px;
      }
      .page {
        padding: 20px 12px 40px;
      }
      .card {
        padding: 20px 16px;
      }
      .radio-row {
        flex-direction: column;
        gap: 8px;
      }
    }
    
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body>

  <!-- HERO SECTION -->
  <div class="hero">
    <div class="hero-logo">
      <!-- 
        IMPORTANT: Pour le logo, 3 options :
        1. Mettez votre fichier logo (Copie de LOGO...) dans le m√™me dossier que ce fichier HTML
        2. OU Modifiez le src ci-dessous avec l'URL compl√®te (https://phenoandco.com/logo.png)
      -->
      <img src="Copie de LOGO PHENO&CO (Vid√©o mobile)_173667...png"

    </div>
    <div class="hero-titles">
      <h1>PHENO&CO</h1>
      <p class="subtitle">Barbershop depuis 2009</p>
    </div>
    
    <div class="hero-buttons">
      <button class="hero-btn btn-yellow" onclick="document.getElementById('reservation').scrollIntoView({behavior: 'smooth'})">
        Louer un Fauteuil
      </button>
      <a href="https://phenoandco.com/" target="_blank" class="hero-btn btn-dark">
        Prendre RDV Coiffure
      </a>
      <a href="https://wa.me/message/MZYDVEN32I55L1" target="_blank" class="hero-btn btn-green">
        Contact WhatsApp
      </a>
    </div>
  </div>

  <div class="page">
    <h1 style="margin-top: 20px;">R√©server un fauteuil</h1>
    <p class="intro">
      Choisissez vos dates, votre formule et vos options.<br />
      Vous recevrez un r√©capitulatif et la r√©servation sera confirm√©e apr√®s paiement de l‚Äôacompte.
    </p>

    <form id="reservation-form">
      <div class="grid" id="reservation">
        <!-- Colonne gauche : formulaire -->
        <div class="card">
          <div class="section-title">
            <span class="icon">üìÖ</span>
            <span>Dates de location</span>
          </div>

          <label for="date-debut">Date de d√©but *</label>
          <input type="date" id="date-debut" name="date_debut" required />

          <label for="date-fin">Date de fin (optionnel)</label>
          <input type="date" id="date-fin" name="date_fin" />

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div>
              <label for="heure-debut">Heure de d√©but *</label>
              <select id="heure-debut" name="heure_debut" required>
                <!-- Options g√©n√©r√©es par JS -->
              </select>
            </div>
            <div>
              <label for="heure-fin">Heure de fin *</label>
              <select id="heure-fin" name="heure_fin" required>
                <!-- Options g√©n√©r√©es par JS -->
              </select>
            </div>
          </div>

          <hr style="border: 0; border-top: 1px solid #1f2937; margin: 20px 0;" />

          <div class="section-title">
            <span class="icon">‚è±Ô∏è</span>
            <span>Type de location</span>
          </div>

          <label>Dur√©e de location *</label>
          <div class="radio-row">
            <label class="radio-pill active" id="pill-courte">
              <input type="radio" name="duree" value="courte" checked />
              <div>
                <span>Courte dur√©e</span>
                <span class="muted">Heure, journ√©e, semaine<br>Acompte 50%</span>
              </div>
            </label>
            <label class="radio-pill" id="pill-longue">
              <input type="radio" name="duree" value="longue" />
              <div>
                <span>Longue dur√©e</span>
                <span class="muted">1 √† 12 mois<br>Acompte 25%</span>
              </div>
            </label>
          </div>

          <label for="formule-courte">Formule courte dur√©e *</label>
          <select id="formule-courte" name="formule_courte">
            <option value="heure">√Ä l'heure ‚Äî 10 ‚Ç¨ HT</option>
            <option value="demi">Demi-journ√©e (4h) ‚Äî 35 ‚Ç¨ HT</option>
            <option value="journee">Journ√©e ‚Äî 65 ‚Ç¨ HT</option>
            <option value="semaine">Semaine ‚Äî 260 ‚Ç¨ HT</option>
          </select>

          <label for="formule-longue">Formule longue dur√©e *</label>
          <select id="formule-longue" name="formule_longue" disabled>
            <option value="1mois">1 mois ‚Äî 65 ‚Ç¨ HT/jour</option>
            <option value="3mois">3 mois ‚Äî 60 ‚Ç¨ HT/jour</option>
            <option value="6mois">6 mois ‚Äî 55 ‚Ç¨ HT/jour</option>
            <option value="12mois">12 mois ‚Äî 50 ‚Ç¨ HT/jour</option>
          </select>

          <label for="pack-materiel">Pack mat√©riel</label>
          <select id="pack-materiel" name="pack_materiel">
            <option value="aucun">Aucun ‚Äî 0 ‚Ç¨</option>
            <option value="essentiel">Pack Essentiel ‚Äî 20 ‚Ç¨ HT</option>
            <option value="premium">Pack Premium ‚Äî 30 ‚Ç¨ HT</option>
          </select>
          <p class="muted" style="margin-top: -12px; margin-bottom: 16px;">
            Essentiel : tondeuse, finition, 2 serviettes, cape.<br>
            Premium : + shaver, s√®che-cheveux, 4 serviettes.
          </p>

          <div class="warning">
            Les montants calcul√©s sont indicatifs. Le calcul final se fera au prorata selon la grille tarifaire lors de la confirmation.
          </div>
        </div>

        <!-- Colonne droite : infos + r√©cap -->
        <div class="card">
          <div class="section-title">
            <span class="icon">üë§</span>
            <span>Vos informations</span>
          </div>

          <label for="nom">Nom complet *</label>
          <input type="text" id="nom" name="nom" required placeholder="Votre nom" />

          <label for="email">Email *</label>
          <input type="email" id="email" name="email" required placeholder="votre@email.com" />

          <label for="telephone">T√©l√©phone *</label>
          <input type="tel" id="telephone" name="telephone" required placeholder="06 00 00 00 00" />

          <label for="commentaire">Commentaire (optionnel)</label>
          <textarea id="commentaire" name="commentaire" placeholder="Pr√©cisez par exemple votre exp√©rience, vos besoins, vos jours de pr√©sence souhait√©s‚Ä¶"></textarea>

          <div class="checkbox-row">
            <input type="checkbox" id="cgv" required />
            <label for="cgv">
              J‚Äôaccepte les
              <a href="#cgv-details" class="cgv-link">conditions g√©n√©rales de location</a>
              et je comprends que la r√©servation est confirm√©e apr√®s paiement de l‚Äôacompte.
            </label>
          </div>

          <div id="summary" class="summary-box">
            <h3>R√©capitulatif (indicatif)</h3>
            <div id="summary-content">
              <!-- Rempli par JS -->
            </div>
          </div>

          <button type="submit" class="btn btn-primary" id="btn-submit" disabled>
            Envoyer ma demande via WhatsApp
          </button>

          <!-- Message de confirmation -->
          <div id="confirmation-message" class="confirmation-box">
            <h4>‚úÖ Demande envoy√©e !</h4>
            <p><span class="check">‚úÖ</span>Vous allez recevoir un email r√©capitulatif avec le d√©tail de votre demande.</p>
            <p><span class="check">‚úÖ</span>Vous retrouvez aussi votre message dans notre conversation WhatsApp.</p>
            
            <!-- Calendar Button will be inserted here by JS -->
            <div id="calendar-container"></div>

            <div style="border-top: 1px solid rgba(34, 197, 94, 0.2); margin-top: 12px; padding-top: 10px;">
              <p>
                PHENO&CO vous enverra ensuite un lien de paiement pour r√©gler l‚Äôacompte
                (50 % pour les locations courtes, 25 % pour les locations longues).
                <strong>La r√©servation sera confirm√©e uniquement apr√®s paiement de cet acompte.</strong>
              </p>
            </div>
          </div>

        </div>
      </div>
    </form>

    <!-- CGV tr√®s simplifi√©es -->
    <div id="cgv-details" class="card" style="margin-top: 24px;">
      <div class="section-title">
        <span class="icon">‚ÑπÔ∏è</span>
        <span>Conditions g√©n√©rales de location (r√©sum√©)</span>
      </div>
      <ul style="padding-left: 20px; line-height: 1.6; opacity: 0.9;">
        <li>La r√©servation est confirm√©e uniquement apr√®s paiement de l‚Äôacompte (50&nbsp;% pour les locations courtes, 25&nbsp;% pour les locations longues).</li>
        <li>Les tarifs indiqu√©s sont hors taxes. La TVA applicable sera ajout√©e lors de la facturation.</li>
        <li>Le locataire est responsable de son activit√©, de sa client√®le, de son assurance professionnelle et du respect des r√®gles d‚Äôhygi√®ne.</li>
        <li>Tout mat√©riel mis √† disposition doit √™tre utilis√© et entretenu avec soin. En cas de casse manifeste par n√©gligence, un remplacement pourra √™tre factur√©.</li>
        <li>En cas d‚Äôannulation moins de 72h avant la date de d√©but, l‚Äôacompte peut √™tre conserv√© √† titre de d√©dommagement.</li>
        <li>PHENO&CO se r√©serve le droit de refuser ou d‚Äôinterrompre une location en cas de non-respect des valeurs du salon ou des r√®gles de fonctionnement.</li>
      </ul>
      <p class="muted" style="margin-top: 16px;">
        La version compl√®te des conditions pourra √™tre envoy√©e par mail avec le contrat de location.
      </p>
    </div>
    
    <footer>
      PHENO&CO ‚Äî Barbershop & Coworking ‚Ä¢ Montpellier
    </footer>
  </div>

  <script>
    // --- INITIALISATION DES HEURES ---
    const heureDebutSelect = document.getElementById('heure-debut');
    const heureFinSelect = document.getElementById('heure-fin');
    
    function populateTimes() {
      const times = [];
      for (let h = 10; h <= 18; h++) {
        times.push(`${h.toString().padStart(2, '0')}:00`);
        if (h < 18) times.push(`${h.toString().padStart(2, '0')}:30`);
      }
      
      times.forEach(t => {
        const opt = document.createElement('option');
        opt.value = t;
        opt.text = t;
        heureDebutSelect.appendChild(opt.cloneNode(true));
        heureFinSelect.appendChild(opt.cloneNode(true));
      });
      
      // Valeurs par d√©faut
      heureDebutSelect.value = "10:00";
      heureFinSelect.value = "11:00";
    }
    populateTimes();

    // --- INITIALISATION DES DATES ---
    const dateDebutInput = document.getElementById('date-debut');
    const dateFinInput = document.getElementById('date-fin');
    const today = new Date().toISOString().split('T')[0];
    dateDebutInput.value = today;
    dateDebutInput.min = today;
    
    dateDebutInput.addEventListener('change', () => {
      dateFinInput.min = dateDebutInput.value;
      if (dateFinInput.value && dateFinInput.value < dateDebutInput.value) {
        dateFinInput.value = dateDebutInput.value;
      }
      updateSummary();
    });

    // --- LOGIQUE ---
    const dureeRadios = document.querySelectorAll('input[name="duree"]');
    const selectCourte = document.getElementById('formule-courte');
    const selectLongue = document.getElementById('formule-longue');
    const pillCourte = document.getElementById('pill-courte');
    const pillLongue = document.getElementById('pill-longue');
    
    const PRICING = {
      courte: {
        heure: { price: 10, label: "√Ä l'heure ‚Äî 10 ‚Ç¨ HT" },
        demi: { price: 35, label: "Demi-journ√©e (4h) ‚Äî 35 ‚Ç¨ HT" },
        journee: { price: 65, label: "Journ√©e ‚Äî 65 ‚Ç¨ HT" },
        semaine: { price: 260, label: "Semaine ‚Äî 260 ‚Ç¨ HT" },
      },
      longue: {
        "1mois": { price: 65, label: "1 mois ‚Äî 65 ‚Ç¨ HT/jour" },
        "3mois": { price: 60, label: "3 mois ‚Äî 60 ‚Ç¨ HT/jour" },
        "6mois": { price: 55, label: "6 mois ‚Äî 55 ‚Ç¨ HT/jour" },
        "12mois": { price: 50, label: "12 mois ‚Äî 50 ‚Ç¨ HT/jour" },
      },
      pack: {
        aucun: { price: 0, label: "Aucun ‚Äî 0 ‚Ç¨" },
        essentiel: { price: 20, label: "Pack Essentiel ‚Äî 20 ‚Ç¨ HT" },
        premium: { price: 30, label: "Pack Premium ‚Äî 30 ‚Ç¨ HT" },
      }
    };

    function updateDureeUI(type) {
      if (type === 'courte') {
        selectCourte.disabled = false;
        selectLongue.disabled = true;
        pillCourte.classList.add('active');
        pillLongue.classList.remove('active');
      } else {
        selectCourte.disabled = true;
        selectLongue.disabled = false;
        pillCourte.classList.remove('active');
        pillLongue.classList.add('active');
      }
      updateSummary();
    }

    dureeRadios.forEach(radio => {
      radio.addEventListener('change', (e) => updateDureeUI(e.target.value));
    });

    // Ecouteurs d'√©v√©nements
    const inputs = document.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
      input.addEventListener('input', updateSummary);
      input.addEventListener('change', updateSummary);
    });

    // --- CALCUL & R√âCAPITULATIF ---
    function getInfo() {
      const dureeType = document.querySelector('input[name="duree"]:checked').value;
      const packType = document.getElementById('pack-materiel').value;
      
      let baseHT = 0;
      let formuleLabel = "";
      
      const start = new Date(dateDebutInput.value);
      const end = dateFinInput.value ? new Date(dateFinInput.value) : start;
      // Diff√©rence en jours (min 1)
      const diffTime = Math.abs(end - start);
      const daysDiff = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1);

      if (dureeType === "courte") {
        const formule = selectCourte.value;
        const data = PRICING.courte[formule];
        formuleLabel = data.label;

        if (formule === "heure") {
          const hStart = parseInt(heureDebutSelect.value.split(':')[0]) + (heureDebutSelect.value.includes('30') ? 0.5 : 0);
          const hEnd = parseInt(heureFinSelect.value.split(':')[0]) + (heureFinSelect.value.includes('30') ? 0.5 : 0);
          let hours = Math.max(0, hEnd - hStart);
          baseHT = hours * 10;
        } else if (formule === "demi") {
          baseHT = 35;
        } else if (formule === "journee") {
          baseHT = 65 * daysDiff;
        } else if (formule === "semaine") {
          const weeks = Math.ceil(daysDiff / 7);
          baseHT = 260 * weeks;
        }
      } else {
        const formule = selectLongue.value;
        const data = PRICING.longue[formule];
        const dailyRate = data.price;
        formuleLabel = data.label;
        
        // Si pas de date de fin, on simule 1 jour pour le tarif indicatif
        const days = dateFinInput.value ? daysDiff : 1;
        baseHT = dailyRate * days;
      }

      const packData = PRICING.pack[packType];
      const packHT = packData.price;
      const packLabel = packData.label;

      const totalHT = baseHT + packHT;
      const tva = totalHT * 0.2;
      const totalTTC = totalHT + tva;
      const acompteTaux = dureeType === "courte" ? 0.5 : 0.25;
      const acompteTTC = totalTTC * acompteTaux;
      const soldeTTC = totalTTC - acompteTTC;

      return {
        duree: dureeType,
        baseHT, packHT, totalHT, tva, totalTTC,
        acompteTaux, acompteTTC, soldeTTC,
        formuleLabel, packLabel
      };
    }

    function updateSummary() {
      const info = getInfo();
      const summaryDiv = document.getElementById('summary-content');
      const btnSubmit = document.getElementById('btn-submit');
      const cgvChecked = document.getElementById('cgv').checked;
      const isFormValid = document.getElementById('reservation-form').checkValidity();

      btnSubmit.disabled = !isFormValid || !cgvChecked;

      summaryDiv.innerHTML = `
        <div class="summary-row"><span>Formule :</span> <span>${info.formuleLabel}</span></div>
        <div class="summary-row"><span>Pack mat√©riel :</span> <span>${info.packLabel}</span></div>
        <div class="summary-row total-ht"><span>Total HT :</span> <span>${info.totalHT.toFixed(2)} ‚Ç¨</span></div>
        <div class="summary-row"><span>TVA (20%) :</span> <span>${info.tva.toFixed(2)} ‚Ç¨</span></div>
        <div class="summary-row total-ttc"><span>Total TTC :</span> <span>${info.totalTTC.toFixed(2)} ‚Ç¨</span></div>
        <div class="summary-row acompte"><span>Acompte √† r√©gler (${(info.acompteTaux * 100).toFixed(0)}%) :</span> <span>${info.acompteTTC.toFixed(2)} ‚Ç¨ TTC</span></div>
      `;
    }

    // --- GOOGLE CALENDAR HELPER ---
    const getGoogleCalendarLink = (title, details, startDate, endDate, startTime, endTime) => {
      const start = new Date(`${startDate}T${startTime}:00`);
      // If endDate is not provided (short term single day), use startDate
      const end = endDate ? new Date(`${endDate}T${endTime}:00`) : new Date(`${startDate}T${endTime}:00`);

      const formatTime = (date) => {
        return date.toISOString().replace(/-|:|\.\d\d\d/g, "").substring(0, 15) + "Z"; 
      };

      const s = formatTime(start);
      const e = formatTime(end);

      const url = new URL("https://www.google.com/calendar/render");
      url.searchParams.append("action", "TEMPLATE");
      url.searchParams.append("text", title);
      url.searchParams.append("details", details);
      url.searchParams.append("dates", `${s}/${e}`);
      url.searchParams.append("location", "PHENO&CO, Montpellier");

      return url.toString();
    };

    // --- SUBMISSION ---
    const form = document.getElementById('reservation-form');
    const confirmationMessage = document.getElementById('confirmation-message');
    const submitBtn = document.getElementById('btn-submit');
    const calendarContainer = document.getElementById('calendar-container');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = "Envoi en cours...";

      const info = getInfo();
      const nom = document.getElementById('nom').value;
      const email = document.getElementById('email').value;
      const tel = document.getElementById('telephone').value;
      const commentaire = document.getElementById('commentaire').value || 'Aucun';
      const dateDebut = dateDebutInput.value;
      const dateFin = dateFinInput.value || 'Non pr√©cis√©';
      const heureDebut = heureDebutSelect.value;
      const heureFin = heureFinSelect.value;

      // Generate Calendar Link
      const calTitle = "Location Fauteuil - PHENO&CO";
      const calDetails = `R√©servation de fauteuil.\\nFormule: ${info.formuleLabel}\\nPack: ${info.packLabel}\\nTotal TTC: ${info.totalTTC.toFixed(2)}‚Ç¨`;
      const calLink = getGoogleCalendarLink(calTitle, calDetails, dateDebut, dateFin === 'Non pr√©cis√©' ? '' : dateFin, heureDebut, heureFin);
      
      // Insert Calendar Button
      calendarContainer.innerHTML = `
        <a href="${calLink}" target="_blank" class="btn-calendar">
          üìÖ Ajouter √† mon Google Agenda
        </a>
      `;

      // --- WHATSAPP REDIRECTION (IMMEDIATE) ---
      const message = `
Nouvelle demande de location de fauteuil ‚Äì PHENO&CO

üìã IDENTIT√â
Nom : ${nom}
Email : ${email}
T√©l : ${tel}

üìÖ P√âRIODE
Du : ${dateDebut}
Au : ${dateFin}
Horaires : ${heureDebut} √† ${heureFin}
Type : ${info.duree === 'courte' ? 'Courte dur√©e' : 'Longue dur√©e'}

‚öôÔ∏è FORMULE & OPTIONS
Formule : ${info.formuleLabel}
Pack Mat√©riel : ${info.packLabel}

üí∞ ESTIMATION
Base HT : ${info.baseHT.toFixed(2)} ‚Ç¨
Pack : ${info.packHT.toFixed(2)} ‚Ç¨
Total HT : ${info.totalHT.toFixed(2)} ‚Ç¨
TVA (20%) : ${info.tva.toFixed(2)} ‚Ç¨
TOTAL TTC : ${info.totalTTC.toFixed(2)} ‚Ç¨

üí≥ ACOMPTE √Ä R√âGLER
Montant (${(info.acompteTaux * 100).toFixed(0)} %) : ${info.acompteTTC.toFixed(2)} ‚Ç¨ TTC
Solde restant : ${info.soldeTTC.toFixed(2)} ‚Ç¨ TTC

üí¨ COMMENTAIRE
${commentaire}

üìÖ Ajouter √† mon agenda :
${calLink}
      `.trim();

      const encoded = encodeURIComponent(message);
      const whatsappUrl = `https://wa.me/33769432605?text=${encoded}`;
      
      // Open immediately
      window.open(whatsappUrl, '_blank');

      // Generate formatted summary for email body (matches generic {{message}} tag)
      const summaryText = `
R√âCAPITULATIF DE LA DEMANDE

--- CLIENT ---
Nom : ${nom}
Email : ${email}
T√©l√©phone : ${tel}

--- P√âRIODE ---
Dates : Du ${dateDebut} au ${dateFin}
Horaires : De ${heureDebut} √† ${heureFin}
Dur√©e : ${info.duree === 'courte' ? 'Courte dur√©e' : 'Longue dur√©e'}

--- FORMULE ---
Formule : ${info.formuleLabel}
Pack Mat√©riel : ${info.packLabel}

--- TARIFS (Estimatif) ---
Base HT : ${info.baseHT.toFixed(2)} ‚Ç¨
Pack HT : ${info.packHT.toFixed(2)} ‚Ç¨
Total HT : ${info.totalHT.toFixed(2)} ‚Ç¨
TVA (20%) : ${info.tva.toFixed(2)} ‚Ç¨
TOTAL TTC : ${info.totalTTC.toFixed(2)} ‚Ç¨

--- PAIEMENT ---
Acompte √† r√©gler : ${info.acompteTTC.toFixed(2)} ‚Ç¨
Solde restant : ${info.soldeTTC.toFixed(2)} ‚Ç¨

--- COMMENTAIRE ---
${commentaire}

--- AGENDA ---
Lien Google Calendar : ${calLink}
      `.trim();

      // --- EMAIL SENDING LOGIC (BACKGROUND) ---
      const templateParams = {
        // Standard fields for generic templates
        name: nom,
        message: summaryText,
        title: "Nouvelle R√©servation Fauteuil",

        // Specific fields
        to_name: nom,
        to_email: email,
        manager_email: "location.phenoandco@gmail.com",
        date_debut: dateDebut,
        date_fin: dateFin,
        heure_debut: heureDebut,
        heure_fin: heureFin,
        duree_details: info.formuleLabel,
        type_location: info.duree === 'courte' ? 'Courte dur√©e' : 'Longue dur√©e',
        formule_label: info.formuleLabel,
        pack_label: info.packLabel,
        base_ht: info.baseHT.toFixed(2),
        pack_ht: info.packHT.toFixed(2),
        total_ht: info.totalHT.toFixed(2),
        tva: info.tva.toFixed(2),
        total_ttc: info.totalTTC.toFixed(2),
        acompte_taux: (info.acompteTaux * 100).toFixed(0),
        acompte_ttc: info.acompteTTC.toFixed(2),
        solde_ttc: info.soldeTTC.toFixed(2),
        telephone: tel,
        commentaire: commentaire,
        calendar_link: calLink
      };

      // Send to Manager AND Client (Sequential calls to ensure both)
      // 1. Send to Manager
      // We modify the 'to_email' param dynamically
      const paramsManager = Object.assign({}, templateParams);
      paramsManager.to_email = "location.phenoandco@gmail.com";
      paramsManager.to_name = "Manager PHENO&CO";

      const paramsClient = Object.assign({}, templateParams);
      paramsClient.to_email = email; // Client email
      paramsClient.to_name = nom;

      // Parallel execution for speed
      Promise.all([
        emailjs.send('service_llizndy', 'template_m6uvyuq', paramsManager),
        emailjs.send('service_llizndy', 'template_m6uvyuq', paramsClient)
      ])
      .then(function(responses) {
           console.log('SUCCESS!', responses);
           confirmationMessage.style.display = 'block';
        }, function(error) {
           console.log('FAILED...', error);
           const errorText = error.text || JSON.stringify(error);
           // Show message even if email fails, because WhatsApp opened
           confirmationMessage.style.display = 'block';
           confirmationMessage.querySelector('h4').innerText = "‚ö†Ô∏è Demande envoy√©e (Erreur Email)";
           confirmationMessage.querySelector('p').innerText = `WhatsApp s'est ouvert, mais l'email a √©chou√© : ${errorText}. V√©rifiez Service ID et Template ID.`;
        })
        .finally(function() {
            submitBtn.textContent = "Envoyer ma demande via WhatsApp";
            submitBtn.disabled = false;
        });
    });

    // Init
    updateSummary();
  </script>
</body>
</html>
