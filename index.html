<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PHENO&CO ‚Äî Carte de visite virtuelle</title>
<meta name="color-scheme" content="dark light">
<style>
  :root{
    --bg:#000;--fg:#fff;--muted:#bdbdbd;--yellow:#ffd400;--grey:#444;--green:#25D366;--focus:#8ab4f8;
    --card:#0f0f0f;--line:#1f1f1f;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg);text-align:center}
  header{padding:24px}
  header img{width:180px;margin-bottom:12px}
  h1{color:var(--yellow);margin:0;font-size:2.2rem}
  .sub{margin:6px 0 10px;color:#ddd}
  .admin{font-size:.85rem;color:#aaa}
  /* NAV : boutons VERTICAUX */
  .nav{display:flex;flex-direction:column;gap:18px;align-items:center;justify-content:center;margin:14px auto 18px}
  .btn{display:block;width:80%;max-width:520px;padding:18px 22px;border-radius:18px;font-weight:800;text-decoration:none;font-size:1.15rem;line-height:1.2}
  .btn:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
  .btn-yellow{background:var(--yellow);color:#000}
  .btn-grey{background:var(--grey);color:#fff}
  .btn-green{background:var(--green);color:#fff}
  .btn:hover{opacity:.95}
  footer{padding:22px 18px;color:#aaa;font-size:.9rem;border-top:1px solid #1b1b1b}

  /* Bandeau notice */
  .notice{max-width:980px;margin:0 auto 22px;color:#ddd}
  .notice b{color:#000;background:var(--yellow);padding:2px 8px;border-radius:8px}

  /* MODAL via :target */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:18px;z-index:999}
  .modal:target{display:flex}
  .box{max-width:980px;width:100%;background:var(--card);border:1px solid var(--line);border-radius:18px;padding:18px;max-height:88vh;overflow:auto;text-align:left}
  .box h2{margin:0 0 10px;color:var(--yellow);text-align:center}
  .close{display:inline-block;margin-top:12px;padding:10px 14px;background:#161616;border:1px solid #2a2a2a;border-radius:10px;color:#fff;text-decoration:none}

  /* FORM */
  label{display:block;margin:10px 0 6px}
  input,select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid #2a2a2a;background:#121212;color:#fff;font-size:16px}
  textarea{min-height:96px;resize:vertical}
  .row{display:grid;gap:12px}
  @media(min-width:680px){.row{grid-template-columns:1fr 1fr}}
  .section-title{font-weight:900;color:#fff;margin:14px 0 6px}
  .accent{color:#000;background:var(--yellow);padding:2px 8px;border-radius:8px;margin-left:8px}
  .hint{font-size:12px;color:#9aa0a6}
  .prices-hint{margin-top:6px;color:#000;background:var(--yellow);display:inline-block;padding:4px 10px;border-radius:999px;font-weight:900}
  .summary{border-top:1px dashed #2b2b2b;margin-top:16px;padding-top:12px;color:#e6e6e6}
  .summary small{color:var(--muted)}
  ul.checklist{list-style:none;padding:0;margin:0;display:grid;gap:8px}
  .actions{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
  .btn-submit,.btn-reset{flex:1;min-width:160px;padding:14px 16px;border-radius:14px;border:none;font-weight:800;cursor:pointer}
  .btn-submit{background:var(--yellow);color:#000}
  .btn-reset{background:var(--grey);color:#fff}

  /* CGV modal */
  .modal.cgv .box{max-width:900px}
  .modal.cgv h3{color:var(--yellow);margin:0 0 10px}
  .modal.cgv h4{margin:14px 0 8px}
  .modal.cgv p,.modal.cgv li{color:#ddd}
  .modal.cgv ul{margin:0 0 8px 18px}
</style>
</head>
<body>
  <header>
    <img src="1.png" alt="Logo PHENO&CO" onerror="this.style.display='none'">
    <h1>PHENO&CO ‚Äî Carte de visite virtuelle</h1>
    <p class="sub">Barbershop ‚Ä¢ Depuis 2009 ‚Ä¢ Montpellier</p>
    <p class="admin">Acc√®s admin : <b>phenoco2025</b> (prototype ‚Äî √† s√©curiser plus tard)</p>
  </header>

  <!-- BOUTONS -->
  <nav class="nav" aria-label="Actions principales">
    <a class="btn btn-yellow" href="#louer">ü™ë Louer un fauteuil</a>
    <a class="btn btn-grey" href="https://phenoandco.com" target="_blank" rel="noopener">‚úÇÔ∏è R√©server une coiffure</a>
    <a class="btn btn-green" href="https://wa.me/33769432605?text=Bonjour%20PHENO%26CO%20!" target="_blank" rel="noopener">Contact WhatsApp</a>
  </nav>

  <div class="notice">
    <p><b>Acompte 50% obligatoire</b> pour les locations ‚Ä¢ <a href="#cgv" style="color:#8ab4f8">CGV affich√©es avant validation</a></p>
  </div>

  <footer>¬© 2025 PHENO&CO. Tous droits r√©serv√©s.</footer>

  <!-- ============ MODAL LOUER UN FAUTEUIL ============ -->
  <div class="modal" id="louer" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true" aria-labelledby="title-fauteuil">
      <h2 id="title-fauteuil">Louer un fauteuil ‚Äî R√©servation</h2>
      <p class="hint">Mobile-first. S√©lectionne ton type de location (courte/longue dur√©e), tes dates, ta formule et le mat√©riel.</p>

      <form id="rentForm" autocomplete="on" novalidate>
        <!-- Identit√© -->
        <div class="row">
          <div><label for="f-name">Nom et pr√©nom</label><input id="f-name" required placeholder="Ex. Jean Dupont"></div>
          <div><label for="f-phone">T√©l√©phone</label><input id="f-phone" required inputmode="tel" placeholder="Ex. 06 12 34 56 78"></div>
        </div>
        <div class="row">
          <div><label for="f-email">Email (pour le r√©cap)</label><input id="f-email" inputmode="email" placeholder="exemple@mail.com"></div>
          <div><label for="f-note">Message (optionnel)</label><input id="f-note" placeholder="Ex. Poste miroir 2, horaires, besoin d‚Äôun shaver‚Ä¶"></div>
        </div>

        <!-- Type de location -->
        <div class="section-title">Type de location <span class="accent">courte ou longue</span></div>
        <div class="row">
          <div>
            <label for="f-type">Choisir</label>
            <select id="f-type" required>
              <option value="short">Courte dur√©e (1h / ¬Ωj / 1j / 1 semaine)</option>
              <option value="long">Longue dur√©e (1 / 3 / 6 / 12 mois)</option>
            </select>
          </div>
          <div>
            <label for="f-start-time">Heure d‚Äôarriv√©e (10:00‚Äì18:00)</label>
            <select id="f-start-time">
              <option>10:00</option><option>11:00</option><option>12:00</option><option>13:00</option>
              <option>14:00</option><option>15:00</option><option>16:00</option><option>17:00</option><option>18:00</option>
            </select>
            <div class="hint">Ignor√© en longue dur√©e (info pour le 1er jour).</div>
          </div>
        </div>

        <!-- Dates (s√©lecteurs robustes) -->
        <div class="section-title">P√©riode <span class="accent">dates</span></div>
        <div class="row">
          <div>
            <label>D√©but</label>
            <div class="row">
              <select id="sd-day"></select><select id="sd-month"></select><select id="sd-year"></select>
            </div>
          </div>
          <div id="endDateWrap">
            <label>Fin</label>
            <div class="row">
              <select id="ed-day"></select><select id="ed-month"></select><select id="ed-year"></select>
            </div>
            <div class="hint" id="autoEndHint" style="display:none">Fin auto selon la dur√©e (aper√ßu sous le r√©cap).</div>
          </div>
        </div>

        <!-- Formules -->
        <div id="shortWrap">
          <div class="section-title">Formule ‚Äî Courte dur√©e <span class="accent">tarifs</span></div>
          <label for="f-formula-short">Choisir une formule</label>
          <select id="f-formula-short">
            <option value="hour">1h ‚Äî 10,00 ‚Ç¨ HT (10‚Ç¨/h)</option>
            <option value="halfday">¬Ω journ√©e (4h) ‚Äî 45,00 ‚Ç¨ HT</option>
            <option value="fullday">1 journ√©e (8h) ‚Äî 70,00 ‚Ç¨ HT</option>
            <option value="week">1 semaine (5 jours) ‚Äî 280,00 ‚Ç¨ HT</option>
          </select>
          <div class="prices-hint">Rappel HT : 1h = 10‚Ç¨, ¬Ωj = 45‚Ç¨, 1j = 70‚Ç¨, 1 semaine (5j) = 280‚Ç¨</div>

          <label for="f-hours-per-day">Heures par jour (courte dur√©e)</label>
          <select id="f-hours-per-day">
            <option value="0.5">0,5 h</option><option value="1">1 h</option><option value="1.5">1,5 h</option><option value="2">2 h</option>
            <option value="2.5">2,5 h</option><option value="3">3 h</option><option value="3.5">3,5 h</option><option value="4">4 h</option>
            <option value="4.5">4,5 h</option><option value="5">5 h</option><option value="5.5">5,5 h</option><option value="6">6 h</option>
            <option value="6.5">6,5 h</option><option value="7">7 h</option><option value="7.5">7,5 h</option><option value="8">8 h</option>
          </select>
          <div class="hint">Changer de formule peut verrouiller la dur√©e (¬Ωj=4h, 1j=8h, 1 semaine=5 jours).</div>
        </div>

        <div id="longWrap" style="display:none">
          <div class="section-title">Formule ‚Äî Longue dur√©e <span class="accent">tarifs</span></div>
          <label for="f-formula-long">Choisir une dur√©e</label>
          <select id="f-formula-long">
            <option value="m1">1 mois ‚Äî 1 300,00 ‚Ç¨ HT</option>
            <option value="m3">3 mois ‚Äî 3 600,00 ‚Ç¨ HT</option>
            <option value="m6">6 mois ‚Äî 6 600,00 ‚Ç¨ HT</option>
            <option value="m12">12 mois ‚Äî 12 000,00 ‚Ç¨ HT</option>
          </select>
          <div class="prices-hint">Base HT mensuelle (indicative) : 1m=1 300‚Ç¨, 3m=3 600‚Ç¨, 6m=6 600‚Ç¨, 12m=12 000‚Ç¨</div>
        </div>

        <!-- Mat√©riel -->
        <div class="section-title">Location petits mat√©riels <span class="accent">au choix</span></div>
        <div class="row">
          <div>
            <b>√Ä la pi√®ce ‚Äî prix/jour (HT)</b>
            <ul class="checklist" id="pieces">
              <li><label><input type="checkbox" value="10" data-label="Tondeuse classique"> Tondeuse classique ‚Äî 10 ‚Ç¨</label></li>
              <li><label><input type="checkbox" value="8"  data-label="Tondeuse finition"> Tondeuse finition ‚Äî 8 ‚Ç¨</label></li>
              <li><label><input type="checkbox" value="6"  data-label="Shaver"> Shaver ‚Äî 6 ‚Ç¨</label></li>
              <li><label><input type="checkbox" value="8"  data-label="S√®che-cheveux"> S√®che-cheveux ‚Äî 8 ‚Ç¨</label></li>
              <li><label><input type="checkbox" value="1"  data-label="Cape"> Cape ‚Äî 1 ‚Ç¨</label></li>
              <li><label><input type="checkbox" value="4"  data-label="Serviettes (lot de 4)"> Serviettes (lot de 4) ‚Äî 4 ‚Ç¨</label></li>
            </ul>
          </div>
          <div>
            <b>Packs (HT)</b>
            <ul class="checklist" id="packs">
              <li><label><input type="checkbox" value="20" data-label="Pack Essentiel"> Pack Essentiel ‚Äî 20 ‚Ç¨</label> <span class="hint">1 tondeuse classique, 1 finition, 2 serviettes, 1 cape</span></li>
              <li><label><input type="checkbox" value="30" data-label="Pack Premium"> Pack Premium ‚Äî 30 ‚Ç¨</label> <span class="hint">1 tondeuse classique, 1 finition, 1 shaver, 4 serviettes, 2 capes</span></li>
            </ul>
            <div class="hint">Pour la courte dur√©e, les prix ‚Äú√† la pi√®ce‚Äù sont compt√©s **par jour** s√©lectionn√©.</div>
          </div>
        </div>

        <!-- CGV -->
        <label style="display:flex;align-items:center;gap:8px;margin-top:14px">
          <input type="checkbox" id="f-cgv" required>
          <span>J‚Äôai lu et j‚Äôaccepte les <a href="#cgv" style="color:#8ab4f8">CGV</a> (version simple + d√©taill√©e).</span>
        </label>

        <!-- R√©sum√© -->
        <div class="summary">
          <div><small>Type :</small> <span id="sum-type">‚Äî</span></div>
          <div><small>P√©riode :</small> <span id="sum-period">‚Äî</span> <span id="sum-autoend" class="hint"></span></div>
          <div id="shortOnlyA">
            <small>Jours compt√©s :</small> <span id="sum-days">0</span> ‚Ä¢ <small>Heures/jour :</small> <span id="sum-hpd">0</span> ‚Ä¢ <small>Dur√©e totale :</small> <span id="sum-hours">0 h</span>
          </div>
          <div><small>Base HT :</small> <span id="sum-base">0 ‚Ç¨</span></div>
          <div><small>Mat√©riel HT :</small> <span id="sum-gear">0 ‚Ç¨</span></div>
          <div><small><b>Redevance 2% (indicative)</b> :</small> <span id="sum-fee">0 ‚Ç¨</span> <span class="hint">Factur√©e mensuellement sur CA d√©clar√©</span></div>
          <div><small>Total HT :</small> <span id="sum-ht">0 ‚Ç¨</span></div>
          <div><small>TVA (20%) :</small> <span id="sum-tva">0 ‚Ç¨</span></div>
          <div><b>Total TTC :</b> <span id="sum-ttc">0 ‚Ç¨</span></div>
          <div><small>Acompte 50% :</small> <span id="sum-deposit">0 ‚Ç¨</span></div>
        </div>

        <!-- Actions -->
        <div class="actions">
          <button class="btn-submit" type="submit">Confirmer & envoyer (WhatsApp)</button>
          <button class="btn-reset" type="reset" id="resetBtn">Effacer</button>
          <a id="emailLink" class="btn btn-grey" href="#" target="_blank" rel="noopener">Envoyer aussi par e-mail</a>
        </div>

        <!-- Fermer le modal (sans JS) -->
        <a href="#" class="close">Fermer</a>
      </form>
    </div>
  </div>

  <!-- ============ MODAL CGV ============ -->
  <div class="modal cgv" id="cgv" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true" aria-labelledby="cgvTitle">
      <h3 id="cgvTitle">CGV ‚Äî PHENO&CO</h3>

      <h4>Version simple</h4>
      <ul>
        <li><b>Objet :</b> location de fauteuils et petits mat√©riels.</li>
        <li><b>Tarifs :</b> courte et longue dur√©e, redevance 2% mensuelle.</li>
        <li><b>Paiement :</b> acompte 50% √† la confirmation ; le reste √† l‚Äôarriv√©e (ou mensuel pour longue dur√©e).</li>
        <li><b>Obligations locataire :</b> respect, entretien, assurance RC Pro.</li>
        <li><b>Obligations bailleur :</b> mise √† disposition, s√©curit√©, maintenance lourde.</li>
        <li><b>R√©siliation :</b> pr√©avis 7 jours (ou imm√©diate en cas de manquement grave).</li>
      </ul>

      <h4>Version d√©taill√©e (trame juriste)</h4>
      <p><b>D√©finitions :</b> Bailleur (PHENO&CO), Locataire, Location courte/longue dur√©e.</p>
      <p><b>Objet :</b> mise √† disposition fauteuils + mat√©riels.</p>
      <p><b>Tarifs/redevance :</b> HT, 2% mensuels sur CA d√©clar√© (acc√®s espace personnel/planning).</p>
      <p><b>Paiement :</b> mensuel, p√©nalit√©s 10% en cas de retard.</p>
      <p><b>Obligations locataire :</b> normes, entretien, RC Pro, sinc√©rit√© d√©clarations, pas de sous-location sans accord.</p>
      <p><b>Obligations bailleur :</b> hygi√®ne, s√©curit√©, maintenance g√©n√©rale, confidentialit√©.</p>
      <p><b>Assurance :</b> RC Pro obligatoire pour le locataire.</p>
      <p><b>R√©siliation :</b> pr√©avis 1 mois (ou imm√©diate en cas de faute grave).</p>
      <p><b>Litiges :</b> m√©diation pr√©alable, puis tribunaux de Montpellier.</p>

      <a href="#" class="close">Fermer</a>
    </div>
  </div>

<script>
/* ===== CONFIG ===== */
const PHONE='33769432605';
const EMAIL='location.phenoandco@gmail.com';
const TVA=0.20;

/* Tarifs courte dur√©e (HT) */
const SHORT_PRICES = {
  hour:     { label:'1h',          pricePerHour: 10 },   // 10 ‚Ç¨/h
  halfday:  { label:'¬Ω journ√©e',   fixedPerBlock: 45, hoursPerDay: 4 },
  fullday:  { label:'1 journ√©e',   fixedPerBlock: 70, hoursPerDay: 8 },
  week:     { label:'1 semaine',   fixedPerBlock: 280, daysPerBlock: 5 }
};

/* Tarifs longue dur√©e (HT) ‚Äî montants totaux pour la dur√©e */
const LONG_PRICES = {
  m1:  { label:'1 mois',   months:1,  total:1300 },
  m3:  { label:'3 mois',   months:3,  total:3600 },
  m6:  { label:'6 mois',   months:6,  total:6600 },
  m12: { label:'12 mois',  months:12, total:12000 }
};

/* ===== HELPERS ===== */
const ‚Ç¨=new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'});
const id=s=>document.getElementById(s);
function pad2(v){return String(v).padStart(2,'0');}
function ymd(d,m,y){return `${y.value}-${m.value}-${d.value}`;}
function parseDate(str){const [Y,M,D]=str.split('-').map(Number);return new Date(Y,M-1,D);}
function daysBetweenInclusive(a,b){
  const A=parseDate(a), B=parseDate(b); A.setHours(0,0,0,0); B.setHours(0,0,0,0);
  return Math.max(0, Math.floor((B-A)/86400000)+1);
}

/* ===== INIT SELECTEURS DATES ===== */
const sdDay=id('sd-day'), sdMonth=id('sd-month'), sdYear=id('sd-year');
const edDay=id('ed-day'), edMonth=id('ed-month'), edYear=id('ed-year');

function fillDMY(daySel, monthSel, yearSel){
  daySel.innerHTML=''; monthSel.innerHTML=''; yearSel.innerHTML='';
  for(let d=1; d<=31; d++) daySel.add(new Option(pad2(d), pad2(d)));
  ['01','02','03','04','05','06','07','08','09','10','11','12'].forEach(m=>monthSel.add(new Option(m,m)));
  const y=new Date().getFullYear(); [y,y+1].forEach(Y=>yearSel.add(new Option(String(Y),String(Y))));
}
function initDates(){
  fillDMY(sdDay,sdMonth,sdYear);
  fillDMY(edDay,edMonth,edYear);
  const t=new Date();
  sdDay.value=pad2(t.getDate()); sdMonth.value=pad2(t.getMonth()+1); sdYear.value=String(t.getFullYear());
  edDay.value=sdDay.value; edMonth.value=sdMonth.value; edYear.value=sdYear.value;
  id('f-start-time').value='10:00';
  id('f-hours-per-day').value='4';
  id('f-type').value='short';
  toggleType();
}
initDates();

/* ===== UI TOGGLE : type courte / longue ===== */
function toggleType(){
  const t=id('f-type').value;
  const short=t==='short';
  id('shortWrap').style.display= short ? 'block':'none';
  id('longWrap').style.display = short ? 'none':'block';
  id('shortOnlyA').style.display = short ? 'block':'none';
  id('endDateWrap').style.display= short ? 'block':'block';
  id('autoEndHint').style.display = short ? 'none':'block';
  id('sum-autoend').textContent='';
}
id('f-type').addEventListener('change', ()=>{ toggleType(); updateAll(); });

/* ===== Verrouiller heures/jour selon formule courte dur√©e ===== */
id('f-formula-short').addEventListener('change', ()=>{
  const key=id('f-formula-short').value;
  if(key==='halfday') { id('f-hours-per-day').value='4';  id('f-hours-per-day').disabled=true; }
  else if(key==='fullday'){ id('f-hours-per-day').value='8'; id('f-hours-per-day').disabled=true; }
  else { id('f-hours-per-day').disabled = (key==='week'); if(key==='week'){ id('f-hours-per-day').value='8'; } }
  updateAll();
});

/* ===== CALCUL ===== */
function gearCostShort(days){
  // Somme √† la pi√®ce (par jour) + packs (forfait)
  const pieces = [...id('pieces').querySelectorAll('input:checked')].reduce((s,el)=>s+Number(el.value),0) * Math.max(1,days);
  const packs  = [...id('packs').querySelectorAll('input:checked')].reduce((s,el)=>s+Number(el.value),0);
  return pieces + packs;
}
function gearCostLong(months){
  // Pour la longue dur√©e, on facture le mat√©riel au forfait mensuel simple : packs x mois + pi√®ces x 20 jours/mois (approx).
  const packs  = [...id('packs').querySelectorAll('input:checked')].reduce((s,el)=>s+Number(el.value),0) * Math.max(1,months);
  const piecesPerDay = [...id('pieces').querySelectorAll('input:checked')].reduce((s,el)=>s+Number(el.value),0);
  const pieces = piecesPerDay * (20*months); // approx 20 jours ouvr√©s / mois
  return packs + pieces;
}

function compute(){
  const type=id('f-type').value;
  const sd=ymd(sdDay,sdMonth,sdYear), ed=ymd(edDay,edMonth,edYear);
  const st=id('f-start-time').value;
  let baseHt=0, gearHt=0, days=0, hoursPerDay=parseFloat(id('f-hours-per-day').value||'0')||0;
  let longMonths=0, autoEndPreview='';

  if(type==='short'){
    const key=id('f-formula-short').value;
    days = daysBetweenInclusive(sd,ed);
    if(key==='hour'){
      const hoursTotal = Math.max(0, days) * hoursPerDay;
      baseHt = hoursTotal * SHORT_PRICES.hour.pricePerHour;
    }else if(key==='halfday'){
      const blocks = Math.max(0, days); // 1 demi-journ√©e par jour s√©lectionn√©
      baseHt = blocks * SHORT_PRICES.halfday.fixedPerBlock;
      hoursPerDay = 4;
    }else if(key==='fullday'){
      const blocks = Math.max(0, days); // 1 journ√©e par jour s√©lectionn√©
      baseHt = blocks * SHORT_PRICES.fullday.fixedPerBlock;
      hoursPerDay = 8;
    }else if(key==='week'){
      const weeks = Math.ceil(Math.max(0, days)/5); // 5 jours = 1 semaine
      baseHt = weeks * SHORT_PRICES.week.fixedPerBlock;
      hoursPerDay = 8;
    }
    gearHt = gearCostShort(days);
  }else{
    const key=id('f-formula-long').value;
    const def=LONG_PRICES[key];
    longMonths=def.months;
    baseHt = def.total;
    // Aper√ßu date de fin auto (simple ajout de mois)
    const d=parseDate(sd); const end=new Date(d.getFullYear(), d.getMonth()+longMonths, d.getDate());
    autoEndPreview = ` ‚Üí fin approx. ${end.getFullYear()}-${pad2(end.getMonth()+1)}-${pad2(end.getDate())}`;
    gearHt = gearCostLong(longMonths);
  }

  const fee = baseHt * 0.02; // redevance 2% indicative (affich√©e √† part)
  const totalHt = baseHt + gearHt;
  const tva = totalHt * TVA;
  const ttc = totalHt + tva;
  const deposit = ttc * 0.5;

  return {type, sd, ed, st, days, hoursPerDay, longMonths, autoEndPreview, baseHt, gearHt, fee, totalHt, tva, ttc, deposit};
}

function updateAll(){
  const c=compute();
  id('sum-type').textContent = (c.type==='short'?'Courte dur√©e':'Longue dur√©e');
  id('sum-period').textContent = `${c.sd} ‚Üí ${c.ed} (arriv√©e ${c.st||'‚Äî'})`;
  id('sum-autoend').textContent = (c.type==='long') ? c.autoEndPreview : '';
  id('sum-days').textContent = c.days;
  id('sum-hpd').textContent = String(c.hoursPerDay).replace('.',',');
  id('sum-hours').textContent = `${(c.days * c.hoursPerDay).toLocaleString('fr-FR')} h`;
  id('sum-base').textContent = ‚Ç¨.format(c.baseHt);
  id('sum-gear').textContent = ‚Ç¨.format(c.gearHt);
  id('sum-fee').textContent  = ‚Ç¨.format(c.fee);
  id('sum-ht').textContent   = ‚Ç¨.format(c.totalHt);
  id('sum-tva').textContent  = ‚Ç¨.format(c.tva);
  id('sum-ttc').textContent  = ‚Ç¨.format(c.ttc);
  id('sum-deposit').textContent = ‚Ç¨.format(c.deposit);

  // email link
  const subject=encodeURIComponent(`Demande de location de fauteuil ‚Äî ${id('f-name').value||''}`);
  const body=encodeURIComponent(
`Demande de location ‚Äî PHENO&CO
Nom: ${id('f-name').value||'-'}
T√©l√©phone: ${id('f-phone').value||'-'}
Email: ${id('f-email').value||'-'}
Type: ${c.type==='short'?'Courte dur√©e':'Longue dur√©e'}
P√©riode: du ${c.sd} ${c.st||'-'} au ${c.ed}${c.type==='long'?c.autoEndPreview:''}
Jours: ${c.days} ‚Ä¢ Heures/jour: ${c.hoursPerDay}
Base HT: ${‚Ç¨.format(c.baseHt)}
Mat√©riel HT: ${‚Ç¨.format(c.gearHt)}
Redevance 2% (indicative): ${‚Ç¨.format(c.fee)}  (factur√©e mensuellement)
Total HT: ${‚Ç¨.format(c.totalHt)}
TVA 20%: ${‚Ç¨.format(c.tva)}
Total TTC: ${‚Ç¨.format(c.ttc)}
Acompte 50%: ${‚Ç¨.format(c.deposit)}
Message: ${id('f-note').value||'-'}

CGV/Contrat: accept√© si coch√©. Merci d‚Äôenvoyer le lien de paiement (acompte 50%).`);
  id('emailLink').href=`mailto:${EMAIL}?subject=${subject}&body=${body}`;
}

/* Listeners */
['change','input'].forEach(evt=>{
  ['f-type','f-start-time','f-hours-per-day','f-formula-short','f-formula-long','f-name','f-phone','f-email','f-note']
    .forEach(fid=>id(fid).addEventListener(evt,updateAll));
  [sdDay,sdMonth,sdYear,edDay,edMonth,edYear].forEach(el=>el.addEventListener(evt,updateAll));
});
[...document.querySelectorAll('#pieces input,#packs input')].forEach(el=>el.addEventListener('change',updateAll));

/* Reset */
id('resetBtn').onclick=()=>setTimeout(()=>{initDates(); updateAll();},0);

/* Submit => WhatsApp */
id('rentForm').addEventListener('submit',(e)=>{
  e.preventDefault();
  const c=compute();
  if(!(id('f-name').value.trim() && id('f-phone').value.trim())){
    alert('Merci de renseigner nom/pr√©nom et t√©l√©phone.'); return;
  }
  if(!id('f-cgv').checked){ alert('Merci d‚Äôaccepter les CGV.'); return; }

  const msg =
`Demande de location ‚Äî PHENO&CO
‚Ä¢ Nom: ${id('f-name').value.trim()}
‚Ä¢ Tel: ${id('f-phone').value.trim()} ‚Ä¢ Email: ${id('f-email').value||'-'}
‚Ä¢ Type: ${c.type==='short'?'Courte dur√©e':'Longue dur√©e'}
‚Ä¢ P√©riode: ${c.sd} ‚Üí ${c.ed} ${c.type==='long'?c.autoEndPreview:''} (arriv√©e ${c.st})
‚Ä¢ Jours: ${c.days} ‚Ä¢ H/j: ${c.hoursPerDay}
‚Ä¢ Base HT: ${‚Ç¨.format(c.baseHt)}
‚Ä¢ Mat√©riel HT: ${‚Ç¨.format(c.gearHt)}
‚Ä¢ Redevance 2% (indicative): ${‚Ç¨.format(c.fee)}
‚Ä¢ Total HT: ${‚Ç¨.format(c.totalHt)} ‚Ä¢ TVA: ${‚Ç¨.format(c.tva)}
‚Ä¢ Total TTC: ${‚Ç¨.format(c.ttc)} ‚Ä¢ Acompte 50%: ${‚Ç¨.format(c.deposit)}
‚Ä¢ Message: ${(id('f-note').value||'-').trim()}

CGV: accept√© ‚úÖ ‚Äî Merci d‚Äôenvoyer le lien de paiement 50%.`;
  window.open(`https://wa.me/${PHONE}?text=${encodeURIComponent(msg)}`,'_blank','noopener');
});

/* First compute */
updateAll();
</script>
</body>
</html>
